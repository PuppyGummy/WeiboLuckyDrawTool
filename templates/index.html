<!DOCTYPE html>
<html>

<head>
    <title>Weibo Lucky Draw Tool</title>
</head>

<body>
    <h1>Weibo Lucky Draw Tool</h1>
    <label for="weiboUrl">Weibo URL:</label>
    <input type="text" id="weiboUrl" placeholder="Input URL...">
    <br><br>
    <label for="userCount">Number of Users to Select:</label>
    <input type="number" id="userCount" min="1">
    <br><br>
    <button onclick="fetchReposts()">Fetch and Select Users</button>
    <div id="result"></div>

    <script>
        async function fetchReposts() {
            const weiboUrl = document.getElementById('weiboUrl').value;
            const userCount = document.getElementById('userCount').value;

            if (!weiboUrl || !userCount) {
                alert("Please provide both Weibo URL and number of users to select.");
                return;
            }

            try {
                const response = await fetch(`http://127.0.0.1:5000//fetch_reposts?weibo_url=${encodeURIComponent(weiboUrl)}&count=${userCount}`, {
                    method: 'GET'
                });

                const data = await response.json();

                if (data.error) {
                    alert("Error: " + data.error);
                    return;
                }

                const userList = data.users;
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `<h3>Selected Users:</h3><ul>${userList.map(user => `<li>${user}</li>`).join('')}</ul>`;
            } catch (error) {
                console.error("Error fetching reposts:", error);
                alert("Error fetching reposts. Check the console for details.");
            }
        }
    </script>
</body>

</html>