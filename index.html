<!DOCTYPE html>
<html>

<head>
    <title>Weibo Repost Fetcher</title>
</head>

<body>
    <h1>Weibo Repost Fetcher</h1>
    <input type="text" id="weiboId" placeholder="请输入微博ID">
    <button onclick="fetchReposts()">获取转发用户</button>
    <div id="userList"></div>

    <script>
        async function fetchReposts() {
            const weiboId = document.getElementById('weiboId').value;
            if (!weiboId) {
                alert("请输入微博ID");
                return;
            }

            try {
                const response = await fetch('/fetch_reposts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ weibo_id: weiboId })
                });

                const data = await response.json();

                if (data.error) {
                    alert("发生错误：" + data.error);
                    return;
                }

                const userList = data.users;
                const userListContainer = document.getElementById('userList');
                userListContainer.innerHTML = '';

                userList.forEach(user => {
                    const userElement = document.createElement('p');
                    userElement.textContent = user;
                    userListContainer.appendChild(userElement);
                });
            } catch (error) {
                console.error("请求出错：", error);
                alert("请求出错，请检查控制台。");
            }
        }
    </script>
</body>

</html>